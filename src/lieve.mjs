var t=function(t){return new Promise(function(r){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){formed=Buffer.concat(n).toString(),r(formed)})})},r=function(t){this.routes=t,this.list=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t}),this.find=this.find.bind(this),this.router=this.router.bind(this)};r.prototype.find=function(t){var r=this,n=[];return{path:"/"+t.replace(/\/$/g,"").split("/").slice(1).map(function(t){return-1!==r.list.indexOf(t)?t:(n.push(t),":par")}).join("/"),params:n}},r.prototype.router=function(r,n){var i=r.url,o=r.method;try{var e=this.routes,u=e.before;void 0===u&&(u=[]);var s=e.after;void 0===s&&(s=[]);var a=this.find(i),f=a.path;r.params=a.params,r.body=t;var c=this.routes[f]||{},p=c.pre;void 0===p&&(p=[]);var d=c.post;void 0===d&&(d=[]);var h=c[o];if("function"!=typeof h)throw new Error("undefined endpoint");u.concat(p,[h],d,s).reduce(function(t,r){return function(n){return r(t(n))}})({req:r,res:n})}catch(t){(0,this.routes.onError)(r,n)}},module.exports=r;

function t(t){var e=this;return new Promise(function(n){var r=[];e.on("data",function(t){return r.push(t)}),e.on("end",function(){var e=Buffer.concat(r).toString();switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),n(i);break;case"binary":n({file:e});break;default:n(e)}})})}function e(t){var e=this;return new Promise(function(n){var r=[];e.ondata=function(t,e,n){var i=t.slice(e,n+e).toString();r.push(i)},e.onend=function(){var e=r.join("");switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),n(i);break;case"binary":n({file:e});break;default:n(e)}}})}function n(t){var e=t.headers.cookie;if(!e)return{};var n={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});n[e[0]]=e[1]}),n}function r(t,e){void 0===e&&(e="&");var n={};return t.url.match(/[^?]+$/)[0].split(e).forEach(function(t){var e=t.split("=");n[e[0]]=e[1]}),n}function i(t,e,n){if(t.hasOwnProperty(e))throw new Error("Trying to override req property");Object.defineProperty(t,e,{value:n})}function a(t,e,n){void 0===e&&(e="text/plain"),void 0===n&&(n=200),this.writeHead(n,{"Content-Type":e}),this.end(t,null,null)}function o(t,e,n){void 0===e&&(e="text/plain"),void 0===n&&(n=200),this.statusCode=n,this.setHeader("Content-Type",e),this.end(t,null,null)}function u(t){if(t)throw new Error(t);return 0}function s(t){return function(e,n){t(e,n,u),e.next()}}var c=function(t){return Object.keys(t).map(function(e){return t[e]})};function f(t){var e={};return Object.keys(t).forEach(function(n){if("use"!==n&&"extend"!==n){var r=t.extend,i=r?r+n.replace(/\/$/,""):n;e[i]={};var a=t[n];Object.keys(a).forEach(function(n){if("use"!==n){var r=t.use||{},o=t.after||{},u=a.use||{},s=a.after||{},f=t.afterTopLevel||{},h=c(t.useTopLevel||{}),v=c(f),p=c(r),d=c(o),l=c(u),b=c(s),w=a[n],m="function"==typeof w?w:(x=w.handler,O=w.after||{},E=c(w.use||{}),j=c(O),E.concat(x,j)),y=h.concat(p,l,[m],b,d,v).flat();e[i][n]=y}var x,O,E,j})}}),e}var h=function(n,r){this.routes=r,this.queues=function(t){var e=t.use;void 0===e&&(e={});var n=t.after;void 0===n&&(n={});var r={},i={};Object.keys(t).forEach(function(a){t[a].hasOwnProperty("extend")?r[a]=Object.assign({},{useTopLevel:e,afterTopLevel:n},t[a]):i[a]=t[a]});var a={};return Object.keys(r).forEach(function(t){a=Object.assign({},a,f(r[t]))}),Object.assign({},a,f(i))}(r),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var e=[];return"/"===t?{path:t,params:e}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return e.push(t),":par"}),params:e}}.bind(this),this.router=function(n){var r="turbo"===n?o:a,i="turbo"===n?e:t;return function(t,e){var n=t.method,a=this.find(t.url),o=a.path,u=a.params;e.send=r;var s=this.queues[o];if((s||{}).hasOwnProperty(n)){var c=s[n];t.params=u,t.queue=c,t.index=0,t.next=function(){var t=this.req,e=this.res;t.index+=1;var n=t.queue[t.index];n&&n(t,e)}.bind({req:t,res:e}),t.body=i,c[0](t,e)}else e.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}}(n).bind(this)};export{h as Lieve,n as _cookie,r as _query,i as _set,s as _express};
//# sourceMappingURL=lieve.mjs.map

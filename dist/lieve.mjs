var t=function(t,r){return new Promise(function(e){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){var t=Buffer.concat(n).toString();switch(r){case"x-www-form-urlencoded":var i={};t.split("&").map(function(t){var r=t.split("=");i[r[0]]=r[1]}),e(i);break;case"binary":e({file:t});break;default:e(t)}})})},r=function(t){var r=t.headers.cookie;if(!r)return{};var e={};return r.split(";").forEach(function(t){var r=t.split("=").map(function(t){return t.trim()});e[r[0]]=r[1]}),e},e=function(t,r){void 0===r&&(r="&");var e={};return t.url.match(/[^?]+$/)[0].split(r).map(function(t){var r=t.split("=");e[r[0]]=r[1]}),e},n=function(t,r,e,n){void 0===n&&(n=!1),Object.defineProperty(t,r,{value:e,writable:n})};function i(t){var r=t.content,e=t.type;void 0===e&&(e="text/plain");var n=t.status;void 0===n&&(n=200),this.writeHead(n,{"Content-Type":e}),this.end(r)}var a=function(t){this.routes=t,this.before=t.before||[],this.after=t.after||[],this.list=function(t){var r=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(r))}(t),this.matchPar=new RegExp(/[^\/]+$/),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.find=this.find.bind(this),this.router=this.router.bind(this)};a.prototype.find=function(t){var r=t.replace(this.matchUrl,""),e=r.match(this.matchPar)[0];return{path:this.list.indexOf(e)>-1?r:r.replace(e,":par"),par:e}},a.prototype.router=function(t,r){r.send=i;try{var e=t.method,n=this.find(t.url),a=n.par,o=this.routes[n.path]||{},s=o.before;void 0===s&&(s=[]);var u=o.after;void 0===u&&(u=[]);var f=o[e];if("function"!=typeof f)throw new Error("undefined handler");var c=this.before.concat(s,[f],u,this.after);t.par=a,t.queue=c,t.index=0,t.next=function(){return this.index+=1,this.queue[this.index]}.bind(t),c[0](t,r)}catch(t){r.send({type:"application/json",status:404,content:JSON.stringify({error:"Not Found",status:404})})}};export{a as Lieve,t as _bodyParser,r as _cookieParser,e as _queryParser,n as _set};
//# sourceMappingURL=lieve.mjs.map

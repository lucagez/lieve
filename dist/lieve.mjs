function t(t){var e=this;return new Promise(function(r){var n=[];e.on("data",function(t){return n.push(t)}),e.on("end",function(){var e=Buffer.concat(n).toString();switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),r(i);break;case"binary":r({file:e});break;default:r(e)}})})}function e(t){var e=this;return new Promise(function(r){var n=[];e.ondata=function(t,e,r){var i=t.slice(e,r+e).toString();n.push(i)},e.onend=function(){var e=n.join("");switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),r(i);break;case"binary":r({file:e});break;default:r(e)}}})}function r(t){var e=t.headers.cookie;if(!e)return{};var r={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});r[e[0]]=e[1]}),r}function n(t,e){void 0===e&&(e="&");var r={};return t.url.match(/[^?]+$/)[0].split(e).forEach(function(t){var e=t.split("=");r[e[0]]=e[1]}),r}function i(t,e,r){if(t.hasOwnProperty(e))throw new Error("Trying to override req property");Object.defineProperty(t,e,{value:r})}function a(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":e}),this.end(t,null,null)}function o(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.statusCode=r,this.setHeader("Content-Type",e),this.end(t,null,null)}function u(t){if(t)throw new Error(t);return 0}function s(t,e,r,n){void 0===n&&(n=[]);var i=t.next;r.apply(void 0,n)(t,e,u),i(t,e)}var c=function(t){return Object.keys(t).map(function(e){return t[e]})};function f(t){var e={};return Object.keys(t).forEach(function(r){if("use"!==r&&"extend"!==r){var n=t.extend,i=n?n+r.replace(/\/$/,""):r;e[i]={};var a=t[r];Object.keys(a).forEach(function(r){if("use"!==r){var n=t.use||{},o=t.after||{},u=a.use||{},s=a.after||{},f=t.afterTopLevel||{},h=c(t.useTopLevel||{}),v=c(f),p=c(n),d=c(o),l=c(u),b=c(s),w=a[r],m="function"==typeof w?w:(x=w.handler,O=w.after||{},E=c(w.use||{}),j=c(O),E.concat(x,j)),y=h.concat(p,l,[m],b,d,v).flat();e[i][r]=y}var x,O,E,j})}}),e}var h=function(r,n){this.routes=n,this.queues=function(t){var e=t.use;void 0===e&&(e={});var r=t.after;void 0===r&&(r={});var n={},i={};Object.keys(t).forEach(function(a){t[a].hasOwnProperty("extend")?n[a]=Object.assign({},{useTopLevel:e,afterTopLevel:r},t[a]):i[a]=t[a]});var a={};return Object.keys(n).forEach(function(t){a=Object.assign({},a,f(n[t]))}),Object.assign({},a,f(i))}(n),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var e=[];return"/"===t?{path:t,params:e}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return e.push(t),":par"}),params:e}}.bind(this),this.router=function(r){var n="turbo"===r?o:a,i="turbo"===r?e:t;return function(t,e){var r=t.method,a=this.find(t.url),o=a.path,u=a.params;e.send=n;var s=this.queues[o];if((s||{}).hasOwnProperty(r)){var c=s[r];t.params=u,t.queue=c,t.index=0,t.next=function(){var t=this.req,e=this.res;t.index+=1;var r=t.queue[t.index];r&&r(t,e)}.bind({req:t,res:e}),t.body=i,c[0](t,e)}else e.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}}(r).bind(this)};export{h as Lieve,t as _body,r as _cookie,n as _query,i as _set,s as _express};
//# sourceMappingURL=lieve.mjs.map

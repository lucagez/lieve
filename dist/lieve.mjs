function t(t,e){return new Promise(function(r){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){var t=Buffer.concat(n).toString();switch(e){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),r(i);break;case"binary":r({file:t});break;default:r(t)}})})}function e(t){var e=t.headers.cookie;if(!e)return{};var r={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});r[e[0]]=e[1]}),r}function r(t,e){void 0===e&&(e="&");var r={};return t.url.match(/[^?]+$/)[0].split(e).forEach(function(t){var e=t.split("=");r[e[0]]=e[1]}),r}function n(t,e,r){if(t.hasOwnProperty(e))throw new Error("Trying to override req property");Object.defineProperty(t,e,{value:r})}function i(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":e}),this.end(t,null,null)}function a(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.statusCode=r,this.setHeader("Content-Type",e),this.end(t,null,null)}function o(t){if(t)throw new Error(t);return 0}function u(t,e,r,n){void 0===n&&(n=[]);var i=t.next;r.apply(void 0,n)(t,e,o),i(t,e)}var s=function(t){return Object.keys(t).map(function(e){return t[e]})};function c(t){var e={};return Object.keys(t).forEach(function(r){if("use"!==r&&"extend"!==r){var n=t.extend,i=n?n+r.replace(/\/$/,""):r;e[i]={};var a=t[r];Object.keys(a).forEach(function(r){if("use"!==r){var n=t.use||{},o=t.after||{},u=a.use||{},c=a.after||{},f=t.afterTopLevel||{},h=s(t.useTopLevel||{}),p=s(f),v=s(n),d=s(o),l=s(u),m=s(c),y=a[r],b="function"==typeof y?y:(x=y.handler,O=y.after||{},E=s(y.use||{}),j=s(O),E.concat(x,j)),w=h.concat(v,l,[b],m,d,p).flat();e[i][r]=w}var x,O,E,j})}}),e}var f=function(t,e){this.routes=e,this.queues=function(t){var e=t.use;void 0===e&&(e={});var r=t.after;void 0===r&&(r={});var n={},i={};Object.keys(t).forEach(function(a){t[a].hasOwnProperty("extend")?n[a]=Object.assign({},{useTopLevel:e,afterTopLevel:r},t[a]):i[a]=t[a]});var a={};return Object.keys(n).forEach(function(t){a=Object.assign({},a,c(n[t]))}),Object.assign({},a,c(i))}(e),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var e=[];return"/"===t?{path:t,params:e}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return e.push(t),":par"}),params:e}}.bind(this),this.router=function(t){var e="turbo"===t?a:i;return function(t,r){var n=t.method,i=this.find(t.url),a=i.path,o=i.params;r.send=e;var u=this.queues[a];if((u||{}).hasOwnProperty(n)){var s=u[n];t.params=o,t.queue=s,t.index=0,t.next=function(){var t=this.req,e=this.res;t.index+=1;var r=t.queue[t.index];r&&r(t,e)}.bind({req:t,res:r}),s[0](t,r)}else r.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}}(t).bind(this)};export{f as Lieve,t as _body,e as _cookie,r as _query,n as _set,u as _express};
//# sourceMappingURL=lieve.mjs.map

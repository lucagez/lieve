function t(t,e){return new Promise(function(n){var r=[];t.on("data",function(t){return r.push(t)}),t.on("end",function(){var t=Buffer.concat(r).toString();switch(e){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),n(i);break;case"binary":n({file:t});break;default:n(t)}})})}function e(t){var e=t.headers.cookie;if(!e)return{};var n={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});n[e[0]]=e[1]}),n}function n(t,e){void 0===e&&(e="&");var n={};return t.url.match(/[^?]+$/)[0].split(e).forEach(function(t){var e=t.split("=");n[e[0]]=e[1]}),n}function r(t,e,n,r){void 0===r&&(r=!1),Object.defineProperty(t,e,{value:n,writable:r})}function i(t,e,n){void 0===e&&(e="text/plain"),void 0===n&&(n=200),this.writeHead(n,{"Content-Type":e}),this.end(t,!1,!1)}function a(t){if(t)throw new Error(t);return 0}function o(t,e,n,r){void 0===r&&(r=[]);var i=t.next;n.apply(void 0,r)(t,e,a),i(t,e)}var u=function(t){return Object.keys(t).map(function(e){return t[e]})};function s(t){var e={};return Object.keys(t).forEach(function(n){if("use"!==n&&"extend"!==n){var r=t.extend,i=r?r+n.replace(/\/$/,""):n;e[i]={};var a=t[n];Object.keys(a).forEach(function(n){if("use"!==n){var r=t.use||{},o=t.after||{},s=a.use||{},c=a.after||{},f=t.afterTopLevel||{},h=u(t.useTopLevel||{}),p=u(f),v=u(r),d=u(o),l=u(s),m=u(c),b=a[n],y="function"==typeof b?b:(x=b.handler,O=b.after||{},j=u(b.use||{}),E=u(O),j.concat(x,E)),w=h.concat(v,l,[y],m,d,p).flat();e[i][n]=w}var x,O,j,E})}}),e}var c=function(t){this.routes=t,this.queues=function(t){var e=t.use;void 0===e&&(e={});var n=t.after;void 0===n&&(n={});var r={},i={};Object.keys(t).forEach(function(a){t[a].hasOwnProperty("extend")?r[a]=Object.assign({},{useTopLevel:e,afterTopLevel:n},t[a]):i[a]=t[a]});var a={};return Object.keys(r).forEach(function(t){a=Object.assign({},a,s(r[t]))}),Object.assign({},a,s(i))}(t),this.list=function(t){var e=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(e))}(t),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var e=[];return"/"===t?{path:t,params:e}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return e.push(t),":par"}),params:e}}.bind(this),this.router=function(t,e){var n=t.method,r=this.find(t.url),a=r.path,o=r.params;e.send=i;var u=this.queues[a];if((u||{}).hasOwnProperty(n)){var s=u[n];t.params=o,t.queue=s,t.index=0,t.next=function(t,e){this.index+=1;var n=this.queue[this.index];n&&n(t,e)}.bind(t),s[0](t,e)}else e.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)};export{c as Lieve,t as _body,e as _cookie,n as _query,r as _set,o as _express};
//# sourceMappingURL=lieve.mjs.map

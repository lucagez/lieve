function t(t,n){return new Promise(function(i){var r=[];t.on("data",function(t){return r.push(t)}),t.on("end",function(){var t=Buffer.concat(r).toString();switch(n){case"x-www-form-urlencoded":var e={};t.split("&").map(function(t){var n=t.split("=");e[n[0]]=n[1]}),i(e);break;case"binary":i({file:t});break;default:i(t)}})})}function n(t){var n=t.headers.cookie;if(!n)return{};var i={};return n.split(";").forEach(function(t){var n=t.split("=").map(function(t){return t.trim()});i[n[0]]=n[1]}),i}function i(t){var n=t.content,i=t.type;void 0===i&&(i="text/plain");var r=t.status;void 0===r&&(r=200),this.statusCode=r,this.setHeader("Content-Type",i),this.end(n)}function r(t,n){this[t]=n}var e=function(t){this.routes=t,this.list=function(t){var n=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(n))}(t),this.index=0,this.find=this.find.bind(this),this.router=this.router.bind(this)};e.prototype.find=function(t){var n=this,i=[];return{path:"/"+t.replace(/\/$/g,"").split("/").slice(1).map(function(t){return n.list.indexOf(t)>-1?t:(i.push(t),":par")}).join("/"),params:i}},e.prototype.router=function(t,n){var e=t.url,o=t.method;!function(t,n){t.set=r,t.next=function(t,n){this.index+=1,this.queue[this.index](t,n)}.bind(t),n.send=i}(t,n);try{var s=this.routes,a=s.before;void 0===a&&(a=[]);var u=s.after;void 0===u&&(u=[]);var f=this.find(e),c=f.params,p=this.routes[f.path]||{},d=p.pre;void 0===d&&(d=[]);var h=p.post;void 0===h&&(h=[]);var v=p[o];if("function"!=typeof v)throw new Error("undefined endpoint");var l=a.concat(d,[v],h,u);t.set("params",c),t.set("queue",l),t.set("index",0),l[0](t,n)}catch(t){n.send({type:"application/json",status:404,content:JSON.stringify({error:"Not Found",status:404})})}};export{e as Lieve,t as _body,n as _cookie};
//# sourceMappingURL=lieve.mjs.map

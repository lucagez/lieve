function t(t,n){return new Promise(function(r){var e=[];t.on("data",function(t){return e.push(t)}),t.on("end",function(){var t=Buffer.concat(e).toString();switch(n){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(t){var n=t.split("=");i[n[0]]=n[1]}),r(i);break;case"binary":r({file:t});break;default:r(t)}})})}function n(t){var n=t.headers.cookie;if(!n)return{};var r={};return n.split(";").forEach(function(t){var n=t.split("=").map(function(t){return t.trim()});r[n[0]]=n[1]}),r}function r(t,n){void 0===n&&(n="&");var r={};return t.url.match(/[^?]+$/)[0].split(n).forEach(function(t){var n=t.split("=");r[n[0]]=n[1]}),r}function e(t,n,r,e){void 0===e&&(e=!1),Object.defineProperty(t,n,{value:r,writable:e})}function i(t,n,r){void 0===n&&(n="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":n}),this.end(t,!1,!1)}function a(t){if(t)throw new Error(t);return 0}function o(t,n,r,e){void 0===e&&(e=[]);var i=t.next;r.apply(void 0,e)(t,n,a),i(t,n)}var u=function(t){return Object.keys(t).map(function(n){return t[n]})};function c(t){var n={};return Object.keys(t).forEach(function(r){if("use"!==r&&"extend"!==r){var e=t.extend,i=e?e+r.replace(/\/$/,""):r;n[i]={};var a=t[r];Object.keys(a).forEach(function(r){if("use"!==r){var e=t.after||{},o=a.use||{},c=a.after||{},s=u(t.use||{}),f=u(e),h=u(o),p=u(c),d=a[r],v="function"==typeof d?d:(m=d.handler,b=d.after||{},y=u(d.use||{}),w=u(b),y.concat(m,w)),l=s.concat(h,[v],p,f).flat();n[i][r]=l}var m,b,y,w})}}),n}var s=function(t){this.routes=t,this.queues=function(t){var n={},r={};Object.keys(t).forEach(function(e){t[e].hasOwnProperty("extend")?n[e]=t[e]:r[e]=t[e]});var e={};return Object.keys(n).forEach(function(t){e=Object.assign({},e,c(n[t]))}),Object.assign({},e,c(r))}(t),this.list=function(t){var n=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(n))}(t),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var n=[];return"/"===t?{path:t,params:n}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return n.push(t),":par"}),params:n}}.bind(this),this.router=function(t,n){var r=t.method,e=this.find(t.url),a=e.path,o=e.params;n.send=i;var u=this.queues[a];if((u||{}).hasOwnProperty(r)){var c=u[r];t.params=o,t.queue=c,t.index=0,t.next=function(t,n){this.index+=1;var r=this.queue[this.index];r&&r(t,n)}.bind(t),c[0](t,n)}else n.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)};export{s as Lieve,t as _body,n as _cookie,r as _query,e as _set,o as _express};

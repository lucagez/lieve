!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.lieve={})}(this,function(t){function e(t){var e=t.content,r=t.type;void 0===r&&(r="text/plain");var n=t.status;void 0===n&&(n=200),this.writeHead(n,{"Content-Type":r}),this.end(e)}var r=function(t){this.routes=t,this.before=t.before||[],this.after=t.after||[],this.list=function(t){var e=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(e))}(t),this.matchPar=new RegExp(/[^\/]+$/),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.find=this.find.bind(this),this.router=this.router.bind(this)};r.prototype.find=function(t){var e=t.replace(this.matchUrl,""),r=e.match(this.matchPar)[0];return{path:this.list.indexOf(r)>-1?e:e.replace(r,":par"),par:r}},r.prototype.router=function(t,r){r.send=e;try{var n=t.method,i=this.find(t.url),o=i.par,a=this.routes[i.path]||{},s=a.before;void 0===s&&(s=[]);var f=a.after;void 0===f&&(f=[]);var u=a[n];if("function"!=typeof u)throw new Error("undefined handler");var c=this.before.concat(s,[u],f,this.after);t.par=o,t.queue=c,t.index=0,t.next=function(){return this.index+=1,this.queue[this.index]}.bind(t),c[0](t,r)}catch(t){r.send({type:"application/json",status:404,content:JSON.stringify({error:"Not Found",status:404})})}},t.Lieve=r,t._bodyParser=function(t,e){return new Promise(function(r){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){var t=Buffer.concat(n).toString();switch(e){case"x-www-form-urlencoded":var i={};t.split("&").map(function(t){var e=t.split("=");i[e[0]]=e[1]}),r(i);break;case"binary":r({file:t});break;default:r(t)}})})},t._cookieParser=function(t){var e=t.headers.cookie;if(!e)return{};var r={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});r[e[0]]=e[1]}),r},t._queryParser=function(t,e){void 0===e&&(e="&");var r={};return t.url.match(/[^?]+$/)[0].split(e).map(function(t){var e=t.split("=");r[e[0]]=e[1]}),r},t._set=function(t,e,r,n){void 0===n&&(n=!1),Object.defineProperty(t,e,{value:r,writable:n})}});
//# sourceMappingURL=lieve.umd.js.map

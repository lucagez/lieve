!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.lieve={})}(this,function(e){function t(e,t,n){void 0===t&&(t="text/plain"),void 0===n&&(n=200),this.writeHead(n,{"Content-Type":t}),this.end(e,null,null)}function n(e,t,n){void 0===t&&(t="text/plain"),void 0===n&&(n=200),this.statusCode=n,this.setHeader("Content-Type",t),this.end(e,null,null)}function r(e){if(e)throw new Error(e);return 0}var i=function(e){return Object.keys(e).map(function(t){return e[t]})};function o(e){var t={};return Object.keys(e).forEach(function(n){if("use"!==n&&"extend"!==n){var r=e.extend,o=r?r+n.replace(/\/$/,""):n;t[o]={};var a=e[n];Object.keys(a).forEach(function(n){if("use"!==n){var r=e.use||{},u=e.after||{},s=a.use||{},c=a.after||{},f=e.afterTopLevel||{},p=i(e.useTopLevel||{}),d=i(f),h=i(r),v=i(u),l=i(s),y=i(c),m=a[n],b="function"==typeof m?m:(w=m.handler,O=m.after||{},j=i(m.use||{}),E=i(O),j.concat(w,E)),x=p.concat(h,l,[b],y,v,d).flat();t[o][n]=x}var w,O,j,E})}}),t}e.Lieve=function(e,r){this.routes=r,this.queues=function(e){var t=e.use;void 0===t&&(t={});var n=e.after;void 0===n&&(n={});var r={},i={};Object.keys(e).forEach(function(o){e[o].hasOwnProperty("extend")?r[o]=Object.assign({},{useTopLevel:t,afterTopLevel:n},e[o]):i[o]=e[o]});var a={};return Object.keys(r).forEach(function(e){a=Object.assign({},a,o(r[e]))}),Object.assign({},a,o(i))}(r),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(e){var t=[];return"/"===e?{path:e,params:t}:{path:e.replace(this.matchUrl,"").replace(this.matchParams,function(e){return t.push(e),":par"}),params:t}}.bind(this),this.router=function(e){var r="turbo"===e?n:t;return function(e,t){var n=e.method,i=this.find(e.url),o=i.path,a=i.params;t.send=r;var u=this.queues[o];if((u||{}).hasOwnProperty(n)){var s=u[n];e.params=a,e.queue=s,e.index=0,e.next=function(){var e=this.req,t=this.res;e.index+=1;var n=e.queue[e.index];n&&n(e,t)}.bind({req:e,res:t}),s[0](e,t)}else t.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}}(e).bind(this)},e._body=function(e,t){return new Promise(function(n){var r=[];e.on("data",function(e){return r.push(e)}),e.on("end",function(){var e=Buffer.concat(r).toString();switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),n(i);break;case"binary":n({file:e});break;default:n(e)}})})},e._cookie=function(e){var t=e.headers.cookie;if(!t)return{};var n={};return t.split(";").forEach(function(e){var t=e.split("=").map(function(e){return e.trim()});n[t[0]]=t[1]}),n},e._query=function(e,t){void 0===t&&(t="&");var n={};return e.url.match(/[^?]+$/)[0].split(t).forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n},e._set=function(e,t,n){if(e.hasOwnProperty(t))throw new Error("Trying to override req property");Object.defineProperty(e,t,{value:n})},e._express=function(e,t,n,i){void 0===i&&(i=[]);var o=e.next;n.apply(void 0,i)(e,t,r),o(e,t)}});
//# sourceMappingURL=lieve.umd.js.map

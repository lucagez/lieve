!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r():"function"==typeof define&&define.amd?define(r):r()}(0,function(){var t=function(t){return new Promise(function(r){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){formed=Buffer.concat(n).toString(),r(formed)})})},r=function(t){this.routes=t,this.list=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t}),this.find=this.find.bind(this),this.router=this.router.bind(this)};r.prototype.find=function(t){var r=this,n=[];return{path:"/"+t.replace(/\/$/g,"").split("/").slice(1).map(function(t){return-1!==r.list.indexOf(t)?t:(n.push(t),":par")}).join("/"),params:n}},r.prototype.router=function(r,n){var e=r.url,o=r.method;try{var i=this.routes,u=i.before;void 0===u&&(u=[]);var f=i.after;void 0===f&&(f=[]);var s=this.find(e),a=s.path;r.params=s.params,r.body=t;var d=this.routes[a]||{},c=d.pre;void 0===c&&(c=[]);var p=d.post;void 0===p&&(p=[]);var h=d[o];if("function"!=typeof h)throw new Error("undefined endpoint");u.concat(c,[h],p,f).reduce(function(t,r){return function(n){return r(t(n))}})({req:r,res:n})}catch(t){(0,this.routes.onError)(r,n)}},module.exports=r});

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.lieve={})}(this,function(e){function t(e,t,n){void 0===t&&(t="text/plain"),void 0===n&&(n=200),this.writeHead(n,{"Content-Type":t}),this.end(e,null,null)}function n(e){if(e)throw new Error(e);return 0}var r=function(e){return Object.keys(e).map(function(t){return e[t]})};function i(e){var t={};return Object.keys(e).forEach(function(n){if("use"!==n&&"extend"!==n){var i=e.extend,a=i?i+n.replace(/\/$/,""):n;t[a]={};var o=e[n];Object.keys(o).forEach(function(n){if("use"!==n){var i=e.use||{},u=e.after||{},s=o.use||{},c=o.after||{},f=e.afterTopLevel||{},p=r(e.useTopLevel||{}),d=r(f),h=r(i),v=r(u),l=r(s),m=r(c),b=o[n],y="function"==typeof b?b:(w=b.handler,O=b.after||{},j=r(b.use||{}),E=r(O),j.concat(w,E)),x=p.concat(h,l,[y],m,v,d).flat();t[a][n]=x}var w,O,j,E})}}),t}e.Lieve=function(e){this.routes=e,this.queues=function(e){var t=e.use;void 0===t&&(t={});var n=e.after;void 0===n&&(n={});var r={},a={};Object.keys(e).forEach(function(i){e[i].hasOwnProperty("extend")?r[i]=Object.assign({},{useTopLevel:t,afterTopLevel:n},e[i]):a[i]=e[i]});var o={};return Object.keys(r).forEach(function(e){o=Object.assign({},o,i(r[e]))}),Object.assign({},o,i(a))}(e),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(e){var t=[];return"/"===e?{path:e,params:t}:{path:e.replace(this.matchUrl,"").replace(this.matchParams,function(e){return t.push(e),":par"}),params:t}}.bind(this),this.router=function(e,n){var r=e.method,i=this.find(e.url),a=i.path,o=i.params;n.send=t;var u=this.queues[a];if((u||{}).hasOwnProperty(r)){var s=u[r];e.params=o,e.queue=s,e.index=0,e.next=function(e,t){this.index+=1;var n=this.queue[this.index];n&&n(e,t)}.bind(e),s[0](e,n)}else n.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)},e._body=function(e,t){return new Promise(function(n){var r=[];e.on("data",function(e){return r.push(e)}),e.on("end",function(){var e=Buffer.concat(r).toString();switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),n(i);break;case"binary":n({file:e});break;default:n(e)}})})},e._cookie=function(e){var t=e.headers.cookie;if(!t)return{};var n={};return t.split(";").forEach(function(e){var t=e.split("=").map(function(e){return e.trim()});n[t[0]]=t[1]}),n},e._query=function(e,t){void 0===t&&(t="&");var n={};return e.url.match(/[^?]+$/)[0].split(t).forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n},e._set=function(e,t,n,r){void 0===r&&(r=!1),Object.defineProperty(e,t,{value:n,writable:r})},e._express=function(e,t,r,i){void 0===i&&(i=[]);var a=e.next;r.apply(void 0,i)(e,t,n),a(e,t)}});
//# sourceMappingURL=lieve.umd.js.map

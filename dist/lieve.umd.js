!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("http")):"function"==typeof define&&define.amd?define(["http"],t):e.lieve=t(e.http)}(this,function(e){var t=function(e){return e.replace(/\//g,"")};function r(e){return function(t){if("function"!=typeof t)throw new TypeError("Middleware must be of type function");this[e]=this[e].concat([t])}}var i={queryDelimiter:"?",notFound:{message:"Not Found",type:"text/plain"}};return function(n){var o=this;if(void 0===n&&(n={}),n&&"object"!=typeof n)throw new TypeError("Config must be of type object");this.routes=new Map,this.asRegistered=[],this.middlewares=[],this.errMiddlewares=[],this.lookup=null,this.find=null,function(e){var t=this;Object.keys(i).forEach(function(r){t[r]=e[r]||i[r]})}.bind(this)(n),e.METHODS.forEach(function(e){o[e]=function(e){return function(r,i,n){var o;if("function"!=typeof n)throw new TypeError("Handler must be a function");if(!Array.isArray(i))throw new TypeError("Middlewares must be an array");if(i.length>0&&i.filter(function(e){return"function"!=typeof e}).length>0)throw new TypeError("Every middleware should be a function");var s=t(r);this.asRegistered.push(r);var a=this.routes.get(s)||{};this.routes.set(s,Object.assign({},a,((o={})[e]=i.concat([n]),o)))}}(e).bind(o)}),this.redirect=function(e,r){var i=new Map,n=r.routes,o=r.asRegistered,s=r.middlewares,a=r.errMiddlewares,u=t(e);n.forEach(function(e,t){return i.set(""+u+t,e)}),this.routes=new Map(Array.from(this.routes).concat(Array.from(i))),this.asRegistered=this.asRegistered.concat(o.map(function(e){return""+u+e})),this.middlewares=this.middlewares.concat(s),this.errMiddlewares=this.errMiddlewares.concat(a)}.bind(this),this.use=r("middlewares").bind(this),this.err=r("errMiddlewares").bind(this),this.start=function(){var e,t,r,i=this;return this.lookup=this.asRegistered.map(function(e){return e.split("/")}).flat().concat([""]).reduce(function(e,t){var r;return Object.assign({},e,((r={})[t]=0,r))},{}),this.find=(e=this.lookup,t=this.queryDelimiter,r=new RegExp("\\"+t+"(.*)"),function(i){var n,o="",s=[],a=i.split("/");if(i.indexOf(t)>-1){var u=a.length-1;a[u]=a[u].replace(r,function(e){return n=e.substr(1),""})}for(var f=a.length,d=0;d<f;d++){var c=a[d];void 0!==e[c]?o+=c:(s.push(c),o+=":par")}return{path:o,params:s,query:n}}),this.routes.forEach(function(e,t){var r={};Object.keys(e).forEach(function(t){r[t]=i.middlewares.concat(e[t])}),i.routes.set(t,r)}),function(e,t){var r=e.method,n=i.find(e.url),o=n.params,s=n.query,a=(i.routes.get(n.path)||{})[r];if("object"!=typeof a)return function(e,t){var r=t.message;e.writeHead(404,{"Content-Type":t.type}),e.end(r)}(t,i.notFound);e.params=o,e.query=s,function(e,t,r,i){var n=e,o=0;return function e(s){var a=[r,i,e];void 0!==s&&(n=t,o=0,a=[s,r,i,e]);var u=n[o++];if(u)return u.apply(void 0,a)}}(a,i.errMiddlewares,e,t)()}}.bind(this)}});

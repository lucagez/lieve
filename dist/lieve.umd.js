!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.lieve={})}(this,function(t){function n(t,n,e){void 0===n&&(n="text/plain"),void 0===e&&(e=200),this.statusCode=e,this.setHeader("Content-Type",n),this.end(t,!1,!1)}function e(t){if(t)throw new Error(t)}var r=function(t){return Object.keys(t).map(function(n){return t[n]})};t.Lieve=function(t){this.routes=t,this.queues=function(t){var n={};return Object.keys(t).forEach(function(e){"use"!==e&&(n[e]={},Object.keys(t[e]).forEach(function(i){if("use"!==i){var o=t[e].use||{},a=r(t.use||{}),u=r(o),s=t[e][i],c="function"==typeof s?s:function(){var t=s.handler;return r(s.use||{}).concat(t)}(),f=a.concat(u,[c]).flat();n[e][i]=f}}))}),n}(t),this.list=function(t){var n=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(n))}(t),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/[0-9]+[^\/]?/g),this.find=function(t){var n=[];return"/"===t?{path:t,params:n}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return n.push(t),":par"}),params:n}}.bind(this),this.router=function(t,e){var r=t.method,i=this.find(t.url),o=i.path,a=i.params;e.send=n;var u=this.queues[o];if((u||{}).hasOwnProperty(r)){var s=u[r];t.params=a,t.queue=s,t.index=0,t.next=function(t,n){return this.index+=1,this.queue[this.index](t,n)}.bind(t),s[0](t,e)}else e.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)},t._body=function(t,n){return new Promise(function(e){var r=[];t.on("data",function(t){return r.push(t)}),t.on("end",function(){var t=Buffer.concat(r).toString();switch(n){case"x-www-form-urlencoded":var i={};t.split("&").map(function(t){var n=t.split("=");i[n[0]]=n[1]}),e(i);break;case"binary":e({file:t});break;default:e(t)}})})},t._cookie=function(t){var n=t.headers.cookie;if(!n)return{};var e={};return n.split(";").forEach(function(t){var n=t.split("=").map(function(t){return t.trim()});e[n[0]]=n[1]}),e},t._query=function(t,n){void 0===n&&(n="&");var e={};return t.url.match(/[^?]+$/)[0].split(n).map(function(t){var n=t.split("=");e[n[0]]=n[1]}),e},t._set=function(t,n,e,r){void 0===r&&(r=!1),Object.defineProperty(t,n,{value:e,writable:r})},t._express=function(t,n,r,i){void 0===i&&(i=[]);var o=t.next;r.apply(void 0,i)(t,n,e),o(t,n)}});
//# sourceMappingURL=lieve.umd.js.map

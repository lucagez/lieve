!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){function t(t,n,e){void 0===e&&(e=200),this.statusCode=e,this.setHeader("Content-Type",t),this.end(n)}function n(){var t=this;return new Promise(function(n){var e=[];t.on("data",function(t){return e.push(t)}),t.on("end",function(){var t=Buffer.concat(e).toString();n(t)})})}function e(t,n){this[t]=n}var i=function(t){this.routes=t,this.list=function(t){return Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t})}(t),this.find=this.find.bind(this),this.router=this.router.bind(this)};i.prototype.find=function(t){var n=this,e=[];return{path:"/"+t.replace(/\/$/g,"").split("/").slice(1).map(function(t){return n.list.indexOf(t)>-1?t:(e.push(t),":par")}).join("/"),params:e}},i.prototype.router=function(i,r){var o=i.url,s=i.method;!function(i,r){i.set=e,i.body=n,r.send=t}(i,r);try{var u=this.routes,f=u.before;void 0===f&&(f=[]);var a=u.after;void 0===a&&(a=[]);var d=this.find(o),c=d.path;i.set("params",d.params);var p=this.routes[c]||{},h=p.pre;void 0===h&&(h=[]);var v=p.post;void 0===v&&(v=[]);var l=p[s];if("function"!=typeof l)throw new Error("undefined endpoint");f.concat(h,[l],v,a).reduce(function(t,n){return function(e){return n(t(e))}})({req:i,res:r})}catch(t){r.send("application/json",JSON.stringify({status:404,error:"Not Found"}),404)}},module.exports=i});

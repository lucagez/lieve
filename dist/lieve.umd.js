!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.lieve={})}(this,function(t){function n(t){var n=t.content,e=t.type;void 0===e&&(e="text/plain");var i=t.status;void 0===i&&(i=200),this.statusCode=i,this.setHeader("Content-Type",e),this.end(n)}function e(t,n){this[t]=n}var i=function(t){this.routes=t,this.list=function(t){var n=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(n))}(t),this.index=0,this.find=this.find.bind(this),this.router=this.router.bind(this)};i.prototype.find=function(t){var n=this,e=[];return{path:"/"+t.replace(/\/$/g,"").split("/").slice(1).map(function(t){return n.list.indexOf(t)>-1?t:(e.push(t),":par")}).join("/"),params:e}},i.prototype.router=function(t,i){var r=t.url,o=t.method;!function(t,i){t.set=e,t.next=function(t,n){this.index+=1,this.queue[this.index](t,n)}.bind(t),i.send=n}(t,i);try{var s=this.routes,a=s.before;void 0===a&&(a=[]);var u=s.after;void 0===u&&(u=[]);var f=this.find(r),c=f.params,d=this.routes[f.path]||{},p=d.pre;void 0===p&&(p=[]);var h=d.post;void 0===h&&(h=[]);var v=d[o];if("function"!=typeof v)throw new Error("undefined endpoint");var l=a.concat(p,[v],h,u);t.set("params",c),t.set("queue",l),t.set("index",0),l[0](t,i)}catch(t){i.send({type:"application/json",status:404,content:JSON.stringify({error:"Not Found",status:404})})}},t.Lieve=i,t._body=function(t,n){return new Promise(function(e){var i=[];t.on("data",function(t){return i.push(t)}),t.on("end",function(){var t=Buffer.concat(i).toString();switch(n){case"x-www-form-urlencoded":var r={};t.split("&").map(function(t){var n=t.split("=");r[n[0]]=n[1]}),e(r);break;case"binary":e({file:t});break;default:e(t)}})})},t._cookie=function(t){var n=t.headers.cookie;if(!n)return{};var e={};return n.split(";").forEach(function(t){var n=t.split("=").map(function(t){return t.trim()});e[n[0]]=n[1]}),e}});
//# sourceMappingURL=lieve.umd.js.map

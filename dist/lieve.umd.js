!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.lieve={})}(this,function(e){function t(e){var t=this;return new Promise(function(n){var r=[];t.on("data",function(e){return r.push(e)}),t.on("end",function(){var t=Buffer.concat(r).toString();switch(e){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),n(i);break;case"binary":n({file:t});break;default:n(t)}})})}function n(e){var t=this;return new Promise(function(n){var r=[];t.ondata=function(e,t,n){var i=e.slice(t,n+t).toString();r.push(i)},t.onend=function(){var t=r.join("");switch(e){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),n(i);break;case"binary":n({file:t});break;default:n(t)}}})}function r(e,t,n){void 0===t&&(t="text/plain"),void 0===n&&(n=200),this.writeHead(n,{"Content-Type":t}),this.end(e,null,null)}function i(e,t,n){void 0===t&&(t="text/plain"),void 0===n&&(n=200),this.statusCode=n,this.setHeader("Content-Type",t),this.end(e,null,null)}function o(e){if(e)throw new Error(e);return 0}var a=function(e){return Object.keys(e).map(function(t){return e[t]})};function u(e){var t={};return Object.keys(e).forEach(function(n){if("use"!==n&&"extend"!==n){var r=e.extend,i=r?r+n.replace(/\/$/,""):n;t[i]={};var o=e[n];Object.keys(o).forEach(function(n){if("use"!==n){var r=e.use||{},u=e.after||{},s=o.use||{},c=o.after||{},f=e.afterTopLevel||{},d=a(e.useTopLevel||{}),p=a(f),h=a(r),v=a(u),l=a(s),y=a(c),b=o[n],m="function"==typeof b?b:(x=b.handler,O=b.after||{},j=a(b.use||{}),E=a(O),j.concat(x,E)),w=d.concat(h,l,[m],y,v,p).flat();t[i][n]=w}var x,O,j,E})}}),t}e.Lieve=function(e,o){this.routes=o,this.queues=function(e){var t=e.use;void 0===t&&(t={});var n=e.after;void 0===n&&(n={});var r={},i={};Object.keys(e).forEach(function(o){e[o].hasOwnProperty("extend")?r[o]=Object.assign({},{useTopLevel:t,afterTopLevel:n},e[o]):i[o]=e[o]});var o={};return Object.keys(r).forEach(function(e){o=Object.assign({},o,u(r[e]))}),Object.assign({},o,u(i))}(o),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(e){var t=[];return"/"===e?{path:e,params:t}:{path:e.replace(this.matchUrl,"").replace(this.matchParams,function(e){return t.push(e),":par"}),params:t}}.bind(this),this.router=function(e){var o="turbo"===e?i:r,a="turbo"===e?n:t;return function(e,t){var n=e.method,r=this.find(e.url),i=r.path,u=r.params;t.send=o;var s=this.queues[i];if((s||{}).hasOwnProperty(n)){var c=s[n];e.params=u,e.queue=c,e.index=0,e.next=function(){var e=this.req,t=this.res;e.index+=1;var n=e.queue[e.index];n&&n(e,t)}.bind({req:e,res:t}),e.body=a,c[0](e,t)}else t.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}}(e).bind(this)},e._body=t,e._cookie=function(e){var t=e.headers.cookie;if(!t)return{};var n={};return t.split(";").forEach(function(e){var t=e.split("=").map(function(e){return e.trim()});n[t[0]]=t[1]}),n},e._query=function(e,t){void 0===t&&(t="&");var n={};return e.url.match(/[^?]+$/)[0].split(t).forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n},e._set=function(e,t,n){if(e.hasOwnProperty(t))throw new Error("Trying to override req property");Object.defineProperty(e,t,{value:n})},e._express=function(e,t,n,r){void 0===r&&(r=[]);var i=e.next;n.apply(void 0,r)(e,t,o),i(e,t)}});
//# sourceMappingURL=lieve.umd.js.map

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.lieve={})}(this,function(t){function e(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":e}),this.end(t,!1,!1)}t.Lieve=function(t){this.routes=t,this.before=t.before||[],this.after=t.after||[],this.queues=function(t){var e={};return Object.keys(t).forEach(function(r){"beforeAll"!==r&&"afterAll"!==r&&(e[r]={},Object.keys(t[r]).forEach(function(i){if("before"!==i&&"after"!==i){var n=t.beforeAll;void 0===n&&(n=[]);var a=t.afterAll;void 0===a&&(a=[]);var o=t[r],f=o.before;void 0===f&&(f=[]);var u=o.after;void 0===u&&(u=[]);var s=n.concat(f,[t[r][i]],u,a);e[r][i]=s}}))}),e}(t),console.log(this.queues),this.list=function(t){var e=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(e))}(t),this.matchPar=new RegExp(/[^\/]+$/),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.find=function(t){if("/"===t)return{path:t,par:void 0};var e=t.replace(this.matchUrl,"");return par=e.match(this.matchPar)[0],path=this.list.indexOf(par)>-1?e:e.replace(par,":par"),{path:path,par:par}}.bind(this),this.router=function(t,r){var i=t.url,n=t.method;t.par=o,t.queue=h,t.index=0,t.next=function(){return this.index+=1,this.queue[this.index]}.bind(t),r.send=e;var a=this.find(i),o=a.par,f=this.routes[a.path]||{},u=f.before;void 0===u&&(u=[]);var s=f.after;void 0===s&&(s=[]);var c=f[n];if(c){var h=this.before.concat(u,[c],s,this.after);h[0](t,r)}else r.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)},t._body=function(t,e){return new Promise(function(r){var i=[];t.on("data",function(t){return i.push(t)}),t.on("end",function(){var t=Buffer.concat(i).toString();switch(e){case"x-www-form-urlencoded":var n={};t.split("&").map(function(t){var e=t.split("=");n[e[0]]=e[1]}),r(n);break;case"binary":r({file:t});break;default:r(t)}})})},t._cookie=function(t){var e=t.headers.cookie;if(!e)return{};var r={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});r[e[0]]=e[1]}),r},t._query=function(t,e){void 0===e&&(e="&");var r={};return t.url.match(/[^?]+$/)[0].split(e).map(function(t){var e=t.split("=");r[e[0]]=e[1]}),r},t._set=function(t,e,r,i){void 0===i&&(i=!1),Object.defineProperty(t,e,{value:r,writable:i})}});
//# sourceMappingURL=lieve.umd.js.map

function t(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":e}),this.end(t,!1,!1)}function e(t){if(t)throw new Error(t);return 0}var r=function(t){return Object.keys(t).map(function(e){return t[e]})};function n(t){var e={};return Object.keys(t).forEach(function(n){if("use"!==n&&"extend"!==n){var i=t.extend,a=i?i+n.replace(/\/$/,""):n;e[a]={};var o=t[n];Object.keys(o).forEach(function(n){if("use"!==n){var i=t.use||{},s=t.after||{},u=o.use||{},c=o.after||{},f=t.afterTopLevel||{},p=r(t.useTopLevel||{}),h=r(f),v=r(i),d=r(s),l=r(u),m=r(c),x=o[n],b="function"==typeof x?x:(w=x.handler,O=x.after||{},j=r(x.use||{}),k=r(O),j.concat(w,k)),y=p.concat(v,l,[b],m,d,h).flat();e[a][n]=y}var w,O,j,k})}}),e}exports.Lieve=function(e){this.routes=e,this.queues=function(t){var e=t.use;void 0===e&&(e={});var r=t.after;void 0===r&&(r={});var i={},a={};Object.keys(t).forEach(function(n){t[n].hasOwnProperty("extend")?i[n]=Object.assign({},{useTopLevel:e,afterTopLevel:r},t[n]):a[n]=t[n]});var o={};return Object.keys(i).forEach(function(t){o=Object.assign({},o,n(i[t]))}),Object.assign({},o,n(a))}(e),this.list=function(t){var e=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(e))}(e),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var e=[];return"/"===t?{path:t,params:e}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return e.push(t),":par"}),params:e}}.bind(this),this.router=function(e,r){var n=e.method,i=this.find(e.url),a=i.path,o=i.params;r.send=t;var s=this.queues[a];if((s||{}).hasOwnProperty(n)){var u=s[n];e.params=o,e.queue=u,e.index=0,e.next=function(t,e){this.index+=1;var r=this.queue[this.index];r&&r(t,e)}.bind(e),u[0](e,r)}else r.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)},exports._body=function(t,e){return new Promise(function(r){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){var t=Buffer.concat(n).toString();switch(e){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),r(i);break;case"binary":r({file:t});break;default:r(t)}})})},exports._cookie=function(t){var e=t.headers.cookie;if(!e)return{};var r={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});r[e[0]]=e[1]}),r},exports._query=function(t,e){void 0===e&&(e="&");var r={};return t.url.match(/[^?]+$/)[0].split(e).forEach(function(t){var e=t.split("=");r[e[0]]=e[1]}),r},exports._set=function(t,e,r,n){void 0===n&&(n=!1),Object.defineProperty(t,e,{value:r,writable:n})},exports._express=function(t,r,n,i){void 0===i&&(i=[]);var a=t.next;n.apply(void 0,i)(t,r,e),a(t,r)};
//# sourceMappingURL=lieve.js.map

function t(t,e,r){void 0===e&&(e="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":e}),this.end(t,!1,!1)}function e(t){if(t)throw new Error(t);return 0}var r=function(t){return Object.keys(t).map(function(e){return t[e]})};function n(t){var e={};return Object.keys(t).forEach(function(n){if("use"!==n&&"extend"!==n){var i=t.extend,a=i?i+n.replace(/\/$/,""):n;e[a]={};var o=t[n];Object.keys(o).forEach(function(n){if("use"!==n){var i=t.after||{},s=o.use||{},u=o.after||{},c=r(t.use||{}),f=r(i),p=r(s),h=r(u),d=o[n],v="function"==typeof d?d:(m=d.handler,x=d.after||{},b=r(d.use||{}),y=r(x),b.concat(m,y)),l=c.concat(p,[v],h,f).flat();e[a][n]=l}var m,x,b,y})}}),e}exports.Lieve=function(e){this.routes=e,this.queues=function(t){var e={},r={};Object.keys(t).forEach(function(n){t[n].hasOwnProperty("extend")?e[n]=t[n]:r[n]=t[n]});var i={};return Object.keys(e).forEach(function(t){i=Object.assign({},i,n(e[t]))}),Object.assign({},i,n(r))}(e),this.list=function(t){var e=Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t});return Array.from(new Set(e))}(e),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(t){var e=[];return"/"===t?{path:t,params:e}:{path:t.replace(this.matchUrl,"").replace(this.matchParams,function(t){return e.push(t),":par"}),params:e}}.bind(this),this.router=function(e,r){var n=e.method,i=this.find(e.url),a=i.path,o=i.params;r.send=t;var s=this.queues[a];if((s||{}).hasOwnProperty(n)){var u=s[n];e.params=o,e.queue=u,e.index=0,e.next=function(t,e){return this.index+=1,this.queue[this.index](t,e)}.bind(e),u[0](e,r)}else r.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)},exports._body=function(t,e){return new Promise(function(r){var n=[];t.on("data",function(t){return n.push(t)}),t.on("end",function(){var t=Buffer.concat(n).toString();switch(e){case"x-www-form-urlencoded":var i={};t.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),r(i);break;case"binary":r({file:t});break;default:r(t)}})})},exports._cookie=function(t){var e=t.headers.cookie;if(!e)return{};var r={};return e.split(";").forEach(function(t){var e=t.split("=").map(function(t){return t.trim()});r[e[0]]=e[1]}),r},exports._query=function(t,e){void 0===e&&(e="&");var r={};return t.url.match(/[^?]+$/)[0].split(e).forEach(function(t){var e=t.split("=");r[e[0]]=e[1]}),r},exports._set=function(t,e,r,n){void 0===n&&(n=!1),Object.defineProperty(t,e,{value:r,writable:n})},exports._express=function(t,r,n,i){void 0===i&&(i=[]);var a=t.next;n.apply(void 0,i)(t,r,e),a(t,r)};
//# sourceMappingURL=lieve.js.map

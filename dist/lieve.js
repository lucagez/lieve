function t(t,n,r){void 0===r&&(r=200),this.statusCode=r,this.setHeader("Content-Type",t),this.end(n)}function n(){var t=this;return new Promise(function(n){var r=[];t.on("data",function(t){return r.push(t)}),t.on("end",function(){var t=Buffer.concat(r).toString();n(t)})})}function r(t,n){this[t]=n}var i=function(t){this.routes=t,this.list=function(t){return Object.keys(t).map(function(t){return t.split("/").slice(1)}).flat().filter(function(t){return":par"!==t})}(t),this.find=this.find.bind(this),this.router=this.router.bind(this)};i.prototype.find=function(t){var n=this,r=[];return{path:"/"+t.replace(/\/$/g,"").split("/").slice(1).map(function(t){return n.list.indexOf(t)>-1?t:(r.push(t),":par")}).join("/"),params:r}},i.prototype.router=function(i,e){var o=i.url,s=i.method;!function(i,e){i.set=r,i.body=n,e.send=t}(i,e);try{var u=this.routes,a=u.before;void 0===a&&(a=[]);var f=u.after;void 0===f&&(f=[]);var c=this.find(o),d=c.path;i.set("params",c.params);var p=this.routes[d]||{},h=p.pre;void 0===h&&(h=[]);var v=p.post;void 0===v&&(v=[]);var l=p[s];if("function"!=typeof l)throw new Error("undefined endpoint");a.concat(h,[l],v,f).reduce(function(t,n){return function(r){return n(t(r))}})({req:i,res:e})}catch(t){e.send("application/json",JSON.stringify({status:404,error:"Not Found"}),404)}},module.exports=i;

function e(e,t,r){void 0===t&&(t="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":t}),this.end(e,null,null)}function t(e){if(e)throw new Error(e);return 0}var r=function(e){return Object.keys(e).map(function(t){return e[t]})};function n(e){var t={};return Object.keys(e).forEach(function(n){if("use"!==n&&"extend"!==n){var i=e.extend,a=i?i+n.replace(/\/$/,""):n;t[a]={};var o=e[n];Object.keys(o).forEach(function(n){if("use"!==n){var i=e.use||{},s=e.after||{},u=o.use||{},c=o.after||{},f=e.afterTopLevel||{},p=r(e.useTopLevel||{}),h=r(f),v=r(i),d=r(s),l=r(u),x=r(c),b=o[n],m="function"==typeof b?b:(w=b.handler,O=b.after||{},j=r(b.use||{}),E=r(O),j.concat(w,E)),y=p.concat(v,l,[m],x,d,h).flat();t[a][n]=y}var w,O,j,E})}}),t}exports.Lieve=function(t){this.routes=t,this.queues=function(e){var t=e.use;void 0===t&&(t={});var r=e.after;void 0===r&&(r={});var i={},a={};Object.keys(e).forEach(function(n){e[n].hasOwnProperty("extend")?i[n]=Object.assign({},{useTopLevel:t,afterTopLevel:r},e[n]):a[n]=e[n]});var o={};return Object.keys(i).forEach(function(e){o=Object.assign({},o,n(i[e]))}),Object.assign({},o,n(a))}(t),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(e){var t=[];return"/"===e?{path:e,params:t}:{path:e.replace(this.matchUrl,"").replace(this.matchParams,function(e){return t.push(e),":par"}),params:t}}.bind(this),this.router=function(t,r){var n=t.method,i=this.find(t.url),a=i.path,o=i.params;r.send=e;var s=this.queues[a];if((s||{}).hasOwnProperty(n)){var u=s[n];t.params=o,t.queue=u,t.index=0,t.next=function(e,t){this.index+=1;var r=this.queue[this.index];r&&r(e,t)}.bind(t),u[0](t,r)}else r.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}.bind(this)},exports._body=function(e,t){return new Promise(function(r){var n=[];e.on("data",function(e){return n.push(e)}),e.on("end",function(){var e=Buffer.concat(n).toString();switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),r(i);break;case"binary":r({file:e});break;default:r(e)}})})},exports._cookie=function(e){var t=e.headers.cookie;if(!t)return{};var r={};return t.split(";").forEach(function(e){var t=e.split("=").map(function(e){return e.trim()});r[t[0]]=t[1]}),r},exports._query=function(e,t){void 0===t&&(t="&");var r={};return e.url.match(/[^?]+$/)[0].split(t).forEach(function(e){var t=e.split("=");r[t[0]]=t[1]}),r},exports._set=function(e,t,r,n){void 0===n&&(n=!1),Object.defineProperty(e,t,{value:r,writable:n})},exports._express=function(e,r,n,i){void 0===i&&(i=[]);var a=e.next;n.apply(void 0,i)(e,r,t),a(e,r)};
//# sourceMappingURL=lieve.js.map

function e(e,t,r){void 0===t&&(t="text/plain"),void 0===r&&(r=200),this.writeHead(r,{"Content-Type":t}),this.end(e,null,null)}function t(e,t,r){void 0===t&&(t="text/plain"),void 0===r&&(r=200),this.statusCode=r,this.setHeader("Content-Type",t),this.end(e,null,null)}function r(e){if(e)throw new Error(e);return 0}var n=function(e){return Object.keys(e).map(function(t){return e[t]})};function i(e){var t={};return Object.keys(e).forEach(function(r){if("use"!==r&&"extend"!==r){var i=e.extend,a=i?i+r.replace(/\/$/,""):r;t[a]={};var o=e[r];Object.keys(o).forEach(function(r){if("use"!==r){var i=e.use||{},s=e.after||{},u=o.use||{},c=o.after||{},f=e.afterTopLevel||{},p=n(e.useTopLevel||{}),h=n(f),v=n(i),d=n(s),l=n(u),x=n(c),y=o[r],b="function"==typeof y?y:(w=y.handler,O=y.after||{},E=n(y.use||{}),j=n(O),E.concat(w,j)),m=p.concat(v,l,[b],x,d,h).flat();t[a][r]=m}var w,O,E,j})}}),t}exports.Lieve=function(r,n){this.routes=n,this.queues=function(e){var t=e.use;void 0===t&&(t={});var r=e.after;void 0===r&&(r={});var n={},a={};Object.keys(e).forEach(function(i){e[i].hasOwnProperty("extend")?n[i]=Object.assign({},{useTopLevel:t,afterTopLevel:r},e[i]):a[i]=e[i]});var o={};return Object.keys(n).forEach(function(e){o=Object.assign({},o,i(n[e]))}),Object.assign({},o,i(a))}(n),this.matchUrl=new RegExp(/\/$|\?(.*)/),this.matchParams=new RegExp(/(?<=\/)\d+/g),this.find=function(e){var t=[];return"/"===e?{path:e,params:t}:{path:e.replace(this.matchUrl,"").replace(this.matchParams,function(e){return t.push(e),":par"}),params:t}}.bind(this),this.router=function(r){var n="turbo"===r?t:e;return function(e,t){var r=e.method,i=this.find(e.url),a=i.path,o=i.params;t.send=n;var s=this.queues[a];if((s||{}).hasOwnProperty(r)){var u=s[r];e.params=o,e.queue=u,e.index=0,e.next=function(){var e=this.req,t=this.res;e.index+=1;var r=e.queue[e.index];r&&r(e,t)}.bind({req:e,res:t}),u[0](e,t)}else t.send(JSON.stringify({error:"Not Found",status:404}),"application/json",404)}}(r).bind(this)},exports._body=function(e,t){return new Promise(function(r){var n=[];e.on("data",function(e){return n.push(e)}),e.on("end",function(){var e=Buffer.concat(n).toString();switch(t){case"x-www-form-urlencoded":var i={};e.split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),r(i);break;case"binary":r({file:e});break;default:r(e)}})})},exports._cookie=function(e){var t=e.headers.cookie;if(!t)return{};var r={};return t.split(";").forEach(function(e){var t=e.split("=").map(function(e){return e.trim()});r[t[0]]=t[1]}),r},exports._query=function(e,t){void 0===t&&(t="&");var r={};return e.url.match(/[^?]+$/)[0].split(t).forEach(function(e){var t=e.split("=");r[t[0]]=t[1]}),r},exports._set=function(e,t,r){if(e.hasOwnProperty(t))throw new Error("Trying to override req property");Object.defineProperty(e,t,{value:r})},exports._express=function(e,t,n,i){void 0===i&&(i=[]);var a=e.next;n.apply(void 0,i)(e,t,r),a(e,t)};
//# sourceMappingURL=lieve.js.map
